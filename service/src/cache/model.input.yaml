- query: "SELECT * FROM namespace WHERE deleted = 0"
  map_def:
      - name: namespaces
        key:
            - "$@.namespace"
        value: "$@"

  arr_def:
      - name: namespace_arr
        value: "$@"

- query: "SELECT * FROM app WHERE deleted = 0"
  map_def:
      - name: apps
        key:
            - "$@.namespace"
            - "$@.app_name"
            - "$@.app_ver"
        value: "$@"

- query: "SELECT * FROM env WHERE deleted = 0"
  map_def:
      - name: envs
        key:
            - "$@.namespace"
            - "$@.env_name"
        value: "$@"

- query: "SELECT * FROM deployment WHERE deleted = 0"
  map_def:
      - name: deployments_by_env
        key:
            - "$@.namespace"
            - "$@.env_name"
            - "$@.app_name"
        value: "$@"

      - name: deployments_by_app
        key:
            - "$@.namespace"
            - "$@.app_name"
            - "$@.env_name"
        value: "$@"

- query: "SELECT * FROM obj WHERE deleted = 0"
  map_def:
      - name: objs
        key:
            - "$@.namespace"
            - "$@.env_name"
            - "$@.app_name"
            - "$@.app_ver"
            - "$@.obj_name"
        value: "$@"

- query: "SELECT * FROM relation WHERE deleted = 0"
  map_def:
      - name: relations_1ton
        key:
            - "$@.namespace"
            - "$@.env_name"
            - "$@.app_name"
            - "$@.app_ver"
            - "$@.obj_name"
            - "$@.objn_name"
        value: "$@"

      - name: relations_nto1
        key:
            - "$@.namespace"
            - "$@.env_name"
            - "$@.app_name"
            - "$@.app_ver"
            - "$@.objn_name"
            - "$@.obj_name"
        value: "$@"

- query: "SELECT * FROM api WHERE deleted = 0"
  map_def:
      - name: apis_by_method
        key:
            - "$@.namespace"
            - "$@.env_name"
            - "$@.app_name"
            - "$@.app_ver"
            - "$@.obj_name"
            - "$@.api_method"
            - "$@.api_endpoint"
        value: "$@"

      - name: apis_by_endpoint
        key:
            - "$@.namespace"
            - "$@.env_name"
            - "$@.app_name"
            - "$@.app_ver"
            - "$@.obj_name"
            - "$@.api_endpoint"
            - "$@.api_method"
        value: "$@"

- query: "SELECT * FROM transform WHERE deleted = 0"
  map_def:
      - name: transforms
        key:
            - "$@.namespace"
            - "$@.env_name"
            - "$@.app_name"
            - "$@.app_ver"
            - "$@.obj_name"
            - "$@.transform_name"
        value: "$@"
