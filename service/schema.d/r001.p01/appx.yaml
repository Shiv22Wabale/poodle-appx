######################################################################
# global
global:
    version: "r001.p01"
    schema_prefix: "{{{MYSQL_CONF.schema_prefix}}}"
    schema_separator: "{{{MYSQL_CONF.schema_separator}}}"

######################################################################
# metadata
_appx_meta:
    - meta_name: "appx.version"
      meta_key: "{{{global.version}}}"
      meta_info:
          comment: "initialize"
    - meta_name: "appx.schema"
      meta_key: "prefix"
      meta_info:
          value: "{{{MYSQL_CONF.schema_prefix}}}"
          comment: "initialize"
    - meta_name: "appx.schema"
      meta_key: "separator"
      meta_info:
          value: "{{{MYSQL_CONF.schema_separator}}}"
          comment: "initialize"

######################################################################
# realm
_realm:
    - realm: "appx"
      realm_spec:
          comment: "initialize [appx] realm"

######################################################################
# user
_user:
    - realm: "appx"
      username: "{{{MYSQL_APPX.appx_node_user}}}@LOCAL"
      password: 'PASSWORD("{{{MYSQL_APPX.appx_node_pass}}}")'
      user_spec:
          comment: "initialize admin user: {{{MYSQL_CONF.appx_node_user}}}@LOCAL"

######################################################################
# _auth_module
_auth_module:
    # local auth
    - realm: "appx"
      module_name: "appx.local"
      module_pattern: "^(.+)(\\@LOCAL)$"
      module_spec:
          protocol: "local_db"
          auth_name: "$1"
          local_db:
              table: "_user"
              field:
                  realm: realm
                  username: username
                  password: password
          comment: "initialize auth module [appx.local]"
    # ldap auth
    - realm: "appx"
      module_name: "appx.ldap_user"
      module_pattern: "^(.+)(\\@LDAP)$"
      module_spec:
          protocol: "ldap"
          auth_name: "$1"
          ldap:
              url: "ldap://{{{LDAP_CONF.ldap_host}}}:{{{LDAP_CONF.ldap_port}}}"
              base_dn: "{{{LDAP_CONF.base_dn}}}"
              search: "(|(uid=%u)(mail=%u)(employeeNumber=%u))"
              group_attr: "memberOf"
          comment: "initialize auth module [appx.ldap_user]"
    # google auth
    - realm: "appx"
      module_name: "appx.google"
      module_pattern: "^(.+)$"
      module_spec:
          protocol: "google"
          auth_name: "$1"
          google:
              some_key: "some_key"
              some_other_key: "some_other_key"
          comment: "initialize auth module [appx.google]"
    # facebook auth
    - realm: "appx"
      module_name: "appx.facebook"
      module_pattern: "^(.+)$"
      module_spec:
          protocol: "facebook"
          auth_name: "$1"
          google:
              some_key: "some_key"
              some_other_key: "some_other_key"
          comment: "initialize auth module [appx.facebook]"
    # github auth
    - realm: "appx"
      module_name: "appx.github"
      module_pattern: "^(.+)$"
      module_spec:
          protocol: "github"
          auth_name: "$1"
          google:
              some_key: "some_key"
              some_other_key: "some_other_key"
          comment: "initialize auth module [appx.facebook]"

######################################################################
# _auth_app_realm
_auth_app_realm:
    - realm: "appx"
      namespace: "sys"
      app_name: "appx"
      app_realm_spec:
          comment: "initialize auth app realm"

######################################################################
# _auth_grant
_auth_grant:
    - namespace: "sys"
      app_name: "appx"
      role_name: "superadmin"
      module_name: "appx"
      grant_type: "user"
      grant_name: "{{{MYSQL_CONF.appx_node_user}}}@LOCAL"
      grant_spec:
          comment: "initialize {{{MYSQL_CONF.appx_node_user}}}@LOCAL"

######################################################################
# _perm_func
_auth_func_perm:
    - namespace: "sys"
      app_name: "appx"
      role_name: "appx.superadmin"
      func_name: "read"
      func_spec:
          comment: "initialize"
    - namespace: "sys"
      app_name: "appx"
      role_name: "appx.superadmin"
      func_name: "write"
      func_spec:
          comment: "initialize"
    - namespace: "sys"
      app_name: "appx"
      role_name: "appx.superadmin"
      func_name: "status"
      func_spec:
          comment: "initialize"

######################################################################
# namespace
namespace:
    - namespace: "sys"
      owner_realm: "appx"
      owner_name: "{{{MYSQL_CONF.appx_node_user}}}@LOCAL"
      namespace_spec:
          comment: "initialize"

######################################################################
# runtime
runtime:
    - namespace: "sys"
      runtime_name: "base"
      runtime_spec:
          comment: "initialize"

######################################################################
# application
app:
    - namespace: "sys"
      app_name: "appx"
      app_ver: "internal"
      app_spec:
          comment: "initialize"

######################################################################
# deployment
deployment:
    - namespace: "sys"
      runtime_name: "base"
      app_name: "appx"
      app_ver: "internal"
      deployment_spec:
          comment: "initialize"
